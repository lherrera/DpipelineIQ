<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1400 1600" style="background: #ffffff; font-family: Arial, sans-serif;">
  <defs>
    <!-- Gradients for visual appeal -->
    <linearGradient id="sourceGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#4A90E2;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#357ABD;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="aiGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#7B68EE;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#6A5ACD;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="mergeGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#50C878;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#3DA35D;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="confGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#FF6B6B;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#E85555;stop-opacity:1" />
    </linearGradient>
    
    <!-- Arrow marker -->
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#333" />
    </marker>
    <marker id="arrowheadAI" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#7B68EE" />
    </marker>
  </defs>

  <!-- Title -->
  <text x="700" y="30" font-size="24" font-weight="bold" text-anchor="middle" fill="#2C3E50">
    PipelineIQ Incremental Architecture
  </text>
  <text x="700" y="55" font-size="14" text-anchor="middle" fill="#7F8C8D" font-style="italic">
    Parallel AI Enrichment via Temporary Views
  </text>

  <!-- Phase 1: Source & Setup -->
  <rect x="550" y="80" width="300" height="60" rx="8" fill="url(#sourceGrad)" stroke="#2C3E50" stroke-width="2"/>
  <text x="700" y="108" font-size="14" font-weight="bold" text-anchor="middle" fill="white">SOURCE TABLE</text>
  <text x="700" y="128" font-size="12" text-anchor="middle" fill="white">main.gtm_silver.use_case_detail</text>

  <!-- Watermark Filter -->
  <path d="M 700 140 L 700 180" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <rect x="590" y="180" width="220" height="50" rx="6" fill="#ECF0F1" stroke="#34495E" stroke-width="2"/>
  <text x="700" y="202" font-size="13" font-weight="bold" text-anchor="middle" fill="#2C3E50">filtered_usecases</text>
  <text x="700" y="218" font-size="11" text-anchor="middle" fill="#7F8C8D">WHERE last_modified_date &gt; watermark</text>

  <!-- PARALLEL FAN-OUT SECTION -->
  <text x="700" y="270" font-size="16" font-weight="bold" text-anchor="middle" fill="#7B68EE">
    ⚡ PARALLEL AI ENRICHMENT (Temporary Views)
  </text>
  
  <!-- Fan-out arrows -->
  <path d="M 700 230 L 700 290" stroke="#7B68EE" stroke-width="3" opacity="0.5"/>
  
  <!-- Left column of parallel AI views -->
  <g id="leftColumn">
    <!-- ai_context -->
    <path d="M 700 290 L 180 320" stroke="#7B68EE" stroke-width="2" marker-end="url(#arrowheadAI)" stroke-dasharray="5,5"/>
    <rect x="50" y="320" width="260" height="75" rx="6" fill="url(#aiGrad)" stroke="#6A5ACD" stroke-width="2"/>
    <text x="180" y="340" font-size="12" font-weight="bold" text-anchor="middle" fill="white">ai_context</text>
    <text x="180" y="358" font-size="10" text-anchor="middle" fill="white">ai_summarize()</text>
    <text x="180" y="373" font-size="9" text-anchor="middle" fill="white" opacity="0.9">BDR notes + business impact</text>
    <text x="180" y="386" font-size="9" text-anchor="middle" fill="white" opacity="0.9">+ authority + funding</text>

    <!-- ai_oneliner -->
    <path d="M 700 290 L 180 420" stroke="#7B68EE" stroke-width="2" marker-end="url(#arrowheadAI)" stroke-dasharray="5,5"/>
    <rect x="50" y="420" width="260" height="65" rx="6" fill="url(#aiGrad)" stroke="#6A5ACD" stroke-width="2"/>
    <text x="180" y="440" font-size="12" font-weight="bold" text-anchor="middle" fill="white">ai_oneliner</text>
    <text x="180" y="458" font-size="10" text-anchor="middle" fill="white">ai_summarize()</text>
    <text x="180" y="473" font-size="9" text-anchor="middle" fill="white" opacity="0.9">Concise use case summary</text>

    <!-- ai_nextsteps -->
    <path d="M 700 290 L 180 510" stroke="#7B68EE" stroke-width="2" marker-end="url(#arrowheadAI)" stroke-dasharray="5,5"/>
    <rect x="50" y="510" width="260" height="65" rx="6" fill="url(#aiGrad)" stroke="#6A5ACD" stroke-width="2"/>
    <text x="180" y="530" font-size="12" font-weight="bold" text-anchor="middle" fill="white">ai_nextsteps</text>
    <text x="180" y="548" font-size="10" text-anchor="middle" fill="white">ai_summarize()</text>
    <text x="180" y="563" font-size="9" text-anchor="middle" fill="white" opacity="0.9">Action-oriented next steps</text>
  </g>

  <!-- Middle column of parallel AI views -->
  <g id="middleColumn">
    <!-- ai_implementation -->
    <path d="M 700 290 L 570 320" stroke="#7B68EE" stroke-width="2" marker-end="url(#arrowheadAI)" stroke-dasharray="5,5"/>
    <rect x="440" y="320" width="260" height="65" rx="6" fill="url(#aiGrad)" stroke="#6A5ACD" stroke-width="2"/>
    <text x="570" y="340" font-size="12" font-weight="bold" text-anchor="middle" fill="white">ai_implementation</text>
    <text x="570" y="358" font-size="10" text-anchor="middle" fill="white">ai_summarize()</text>
    <text x="570" y="373" font-size="9" text-anchor="middle" fill="white" opacity="0.9">Implementation plan summary</text>

    <!-- ai_blockers -->
    <path d="M 700 290 L 570 410" stroke="#7B68EE" stroke-width="2" marker-end="url(#arrowheadAI)" stroke-dasharray="5,5"/>
    <rect x="440" y="410" width="260" height="75" rx="6" fill="url(#aiGrad)" stroke="#6A5ACD" stroke-width="2"/>
    <text x="570" y="430" font-size="12" font-weight="bold" text-anchor="middle" fill="white">ai_blockers</text>
    <text x="570" y="448" font-size="10" text-anchor="middle" fill="white">ai_summarize()</text>
    <text x="570" y="463" font-size="9" text-anchor="middle" fill="white" opacity="0.9">Blocker category + comment</text>
    <text x="570" y="476" font-size="9" text-anchor="middle" fill="white" opacity="0.9">num_of_blockers logic</text>

    <!-- ai_usecase_types -->
    <path d="M 700 290 L 570 510" stroke="#7B68EE" stroke-width="2" marker-end="url(#arrowheadAI)" stroke-dasharray="5,5"/>
    <rect x="440" y="510" width="260" height="75" rx="6" fill="url(#aiGrad)" stroke="#6A5ACD" stroke-width="2"/>
    <text x="570" y="530" font-size="12" font-weight="bold" text-anchor="middle" fill="white">ai_usecase_types</text>
    <text x="570" y="548" font-size="10" text-anchor="middle" fill="white">ai_classify() + ai_query()</text>
    <text x="570" y="563" font-size="9" text-anchor="middle" fill="white" opacity="0.9">usecase_type (technical)</text>
    <text x="570" y="576" font-size="9" text-anchor="middle" fill="white" opacity="0.9">business_usecase_type</text>
  </g>

  <!-- Right column -->
  <g id="rightColumn">
    <!-- ai_soundbyte -->
    <path d="M 700 290 L 1220 350" stroke="#7B68EE" stroke-width="2" marker-end="url(#arrowheadAI)" stroke-dasharray="5,5"/>
    <rect x="1090" y="350" width="260" height="75" rx="6" fill="url(#aiGrad)" stroke="#6A5ACD" stroke-width="2"/>
    <text x="1220" y="370" font-size="12" font-weight="bold" text-anchor="middle" fill="white">ai_soundbyte</text>
    <text x="1220" y="388" font-size="10" text-anchor="middle" fill="white">ai_gen()</text>
    <text x="1220" y="403" font-size="9" text-anchor="middle" fill="white" opacity="0.9">Executive elevator pitch</text>
    <text x="1220" y="416" font-size="9" text-anchor="middle" fill="white" opacity="0.9">Tech → Business outcome</text>
  </g>

  <!-- Convergence to confidence -->
  <text x="700" y="630" font-size="14" font-weight="bold" text-anchor="middle" fill="#FF6B6B">
    Sequential Confidence Scoring
  </text>
  
  <path d="M 180 575 L 700 660" stroke="#FF6B6B" stroke-width="2" opacity="0.3"/>
  <path d="M 180 485 L 700 660" stroke="#FF6B6B" stroke-width="2" opacity="0.3"/>
  <path d="M 180 395 L 700 660" stroke="#FF6B6B" stroke-width="2" opacity="0.3"/>
  <path d="M 570 385 L 700 660" stroke="#FF6B6B" stroke-width="2" opacity="0.3"/>
  <path d="M 570 448 L 700 660" stroke="#FF6B6B" stroke-width="2" opacity="0.3"/>
  <path d="M 570 548 L 700 660" stroke="#FF6B6B" stroke-width="2" opacity="0.3"/>
  
  <!-- ai_confidence -->
  <rect x="570" y="660" width="260" height="75" rx="6" fill="url(#confGrad)" stroke="#E85555" stroke-width="2"/>
  <text x="700" y="680" font-size="12" font-weight="bold" text-anchor="middle" fill="white">ai_confidence</text>
  <text x="700" y="698" font-size="10" text-anchor="middle" fill="white">ai_query(gemma-3-12b)</text>
  <text x="700" y="713" font-size="9" text-anchor="middle" fill="white" opacity="0.9">MEDDPICC-based scoring</text>
  <text x="700" y="726" font-size="9" text-anchor="middle" fill="white" opacity="0.9">8 dimension scores → confidence</text>

  <!-- parsed_confidence -->
  <path d="M 700 735 L 700 760" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <rect x="590" y="760" width="220" height="55" rx="6" fill="#FFE5E5" stroke="#E85555" stroke-width="2"/>
  <text x="700" y="780" font-size="12" font-weight="bold" text-anchor="middle" fill="#C0392B">parsed_confidence</text>
  <text x="700" y="796" font-size="10" text-anchor="middle" fill="#C0392B">regex extract scores</text>
  <text x="700" y="808" font-size="9" text-anchor="middle" fill="#A93226">+ override for &gt;3 blockers</text>

  <!-- normalized_confidence -->
  <path d="M 700 815 L 700 840" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <rect x="590" y="840" width="220" height="50" rx="6" fill="#FFE5E5" stroke="#E85555" stroke-width="2"/>
  <text x="700" y="860" font-size="12" font-weight="bold" text-anchor="middle" fill="#C0392B">normalized_confidence</text>
  <text x="700" y="878" font-size="10" text-anchor="middle" fill="#C0392B">High / Medium / Low thresholds</text>

  <!-- Recommendations layer -->
  <text x="700" y="930" font-size="14" font-weight="bold" text-anchor="middle" fill="#50C878">
    AI Recommendations (Parallel)
  </text>
  
  <path d="M 700 890 L 700 950" stroke="#50C878" stroke-width="3" opacity="0.5"/>
  
  <!-- ai_next_best_action -->
  <path d="M 700 950 L 400 980" stroke="#50C878" stroke-width="2" marker-end="url(#arrowhead)" stroke-dasharray="5,5"/>
  <rect x="270" y="980" width="260" height="70" rx="6" fill="url(#mergeGrad)" stroke="#3DA35D" stroke-width="2"/>
  <text x="400" y="1000" font-size="12" font-weight="bold" text-anchor="middle" fill="white">ai_next_best_action</text>
  <text x="400" y="1018" font-size="10" text-anchor="middle" fill="white">ai_query(gpt-oss-20b)</text>
  <text x="400" y="1033" font-size="9" text-anchor="middle" fill="white" opacity="0.9">MEDDPICC-driven recommendation</text>
  <text x="400" y="1045" font-size="9" text-anchor="middle" fill="white" opacity="0.9">Account team next action</text>

  <!-- ai_slippage_acceleration -->
  <path d="M 700 950 L 1000 980" stroke="#50C878" stroke-width="2" marker-end="url(#arrowhead)" stroke-dasharray="5,5"/>
  <rect x="870" y="980" width="260" height="70" rx="6" fill="url(#mergeGrad)" stroke="#3DA35D" stroke-width="2"/>
  <text x="1000" y="1000" font-size="12" font-weight="bold" text-anchor="middle" fill="white">ai_slippage_acceleration</text>
  <text x="1000" y="1018" font-size="10" text-anchor="middle" fill="white">ai_classify()</text>
  <text x="1000" y="1033" font-size="9" text-anchor="middle" fill="white" opacity="0.9">likely_to_slip + slippage_category</text>
  <text x="1000" y="1045" font-size="9" text-anchor="middle" fill="white" opacity="0.9">can_be_accelerated + accel_category</text>

  <!-- Final assembly -->
  <path d="M 400 1050 L 700 1100" stroke="#333" stroke-width="2" opacity="0.3"/>
  <path d="M 1000 1050 L 700 1100" stroke="#333" stroke-width="2" opacity="0.3"/>
  <path d="M 700 890 L 700 1100" stroke="#333" stroke-width="2" opacity="0.3"/>
  
  <rect x="570" y="1100" width="260" height="60" rx="6" fill="#34495E" stroke="#2C3E50" stroke-width="2"/>
  <text x="700" y="1125" font-size="13" font-weight="bold" text-anchor="middle" fill="white">enriched_results</text>
  <text x="700" y="1145" font-size="11" text-anchor="middle" fill="white">JOIN all AI temp views</text>

  <!-- MERGE -->
  <path d="M 700 1160 L 700 1200" stroke="#333" stroke-width="3" marker-end="url(#arrowhead)"/>
  <rect x="550" y="1200" width="300" height="70" rx="8" fill="url(#mergeGrad)" stroke="#2C3E50" stroke-width="3"/>
  <text x="700" y="1225" font-size="15" font-weight="bold" text-anchor="middle" fill="white">MERGE INTO</text>
  <text x="700" y="1245" font-size="13" text-anchor="middle" fill="white">catalog.schema.pipelineiq</text>
  <text x="700" y="1262" font-size="11" text-anchor="middle" fill="white" opacity="0.9">ON usecase_id (upsert)</text>

  <!-- View -->
  <path d="M 700 1270 L 700 1300" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <rect x="570" y="1300" width="260" height="55" rx="6" fill="#E8F5E9" stroke="#4CAF50" stroke-width="2"/>
  <text x="700" y="1323" font-size="13" font-weight="bold" text-anchor="middle" fill="#2E7D32">pipelineiq_view</text>
  <text x="700" y="1343" font-size="11" text-anchor="middle" fill="#388E3C">Business-ready reporting layer</text>

  <!-- Legend -->
  <g id="legend">
    <rect x="50" y="1420" width="1300" height="150" rx="8" fill="#F8F9FA" stroke="#BDC3C7" stroke-width="2"/>
    <text x="70" y="1445" font-size="14" font-weight="bold" fill="#2C3E50">Key Architectural Features:</text>
    
    <circle cx="80" cy="1470" r="6" fill="#7B68EE"/>
    <text x="95" y="1475" font-size="12" fill="#2C3E50">
      <tspan font-weight="bold">Parallel Fan-out:</tspan> 7 independent AI enrichment views computed simultaneously from filtered_usecases
    </text>
    
    <circle cx="80" cy="1495" r="6" fill="#FF6B6B"/>
    <text x="95" y="1500" font-size="12" fill="#2C3E50">
      <tspan font-weight="bold">Sequential Dependencies:</tspan> Confidence scoring uses outputs from all enrichment views
    </text>
    
    <circle cx="80" cy="1520" r="6" fill="#50C878"/>
    <text x="95" y="1525" font-size="12" fill="#2C3E50">
      <tspan font-weight="bold">Modularity:</tspan> Each temp view is self-contained; new enrichments easily added to fan-out layer
    </text>
    
    <circle cx="80" cy="1545" r="6" fill="#4A90E2"/>
    <text x="95" y="1550" font-size="12" fill="#2C3E50">
      <tspan font-weight="bold">Incremental Processing:</tspan> Watermark-based (piq_last_updated) ensures only new/changed records processed
    </text>
  </g>

  <!-- Annotations -->
  <g id="annotations" opacity="0.7">
    <!-- Modular callout -->
    <rect x="330" y="290" width="90" height="30" rx="4" fill="#FFF9C4" stroke="#F9A825" stroke-width="1"/>
    <text x="375" y="308" font-size="10" text-anchor="middle" fill="#F57F17" font-weight="bold">Extendable!</text>
    
    <!-- Parallel callout -->
    <rect x="820" y="260" width="120" height="30" rx="4" fill="#E1F5FE" stroke="#0288D1" stroke-width="1"/>
    <text x="880" y="278" font-size="10" text-anchor="middle" fill="#01579B" font-weight="bold">No dependencies</text>
  </g>
</svg>
